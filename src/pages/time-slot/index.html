<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Karla:ital,wght@0,200..800;1,200..800&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../../styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <title>TabasOnLock</title>
    <style type="text/tailwindcss">
      @theme inline {
        --color-background: var(--background);
        --color-foreground: var(--foreground);

        --font-playfair-display: "Playfair Display", serif;
        --font-karla: "Karla", sans-serif;
        --font-rubik: "Rubik", sans-serif;

        --color-sidebar-ring: var(--sidebar-ring);
        --color-sidebar-border: var(--sidebar-border);
        --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
        --color-sidebar-accent: var(--sidebar-accent);
        --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
        --color-sidebar-primary: var(--sidebar-primary);
        --color-sidebar-foreground: var(--sidebar-foreground);
        --color-sidebar: var(--sidebar);

        --color-ring: var(--ring);
        --color-input: var(--input);
        --color-border: var(--border);
        --color-destructive: var(--destructive);
        --color-accent-foreground: var(--accent-foreground);
        --color-accent: var(--accent);
        --color-muted-foreground: var(--muted-foreground);
        --color-muted: var(--muted);
        --color-secondary-foreground: var(--secondary-foreground);
        --color-secondary: var(--secondary);
        --color-primary-foreground: var(--primary-foreground);
        --color-primary: var(--primary);
        --color-dark-fg: var(--dark-fg);
        --color-dark-secondary-fg: var(--dark-secondary-fg);
        --color-dark-muted-fg: var(--dark-muted-fg);

        --color-popover-foreground: var(--popover-foreground);
        --color-popover: var(--popover);
        --color-card-foreground: var(--card-foreground);
        --color-card: var(--card);
      }

      :root {
        --background: #000;
        --foreground: #fff;

        --card: #f1f9f4;
        --card-foreground: oklch(0.141 0.005 285.823);

        --popover: oklch(1 0 0);
        --popover-foreground: oklch(0.141 0.005 285.823);

        --primary: #f70670;
        --primary-foreground: #f1f9f4;
        --secondary: #ff3e8f;
        --secondary-foreground: #e4e4e4;

        --muted: oklch(0.967 0.001 286.375);
        --muted-foreground: #c3c3c3;
        --accent: oklch(0.967 0.001 286.375);
        --accent-foreground: oklch(0.21 0.006 285.885);

        --dark-fg: #222;
        --dark-secondary-fg: #444;
        --dark-muted-fg: #666;

        --destructive: oklch(0.577 0.245 27.325);
        --border: oklch(0.92 0.004 286.32);
        --input: oklch(0.92 0.004 286.32);
        --ring: oklch(0.705 0.015 286.067);

        --sidebar: oklch(0.985 0 0);
        --sidebar-foreground: oklch(0.141 0.005 285.823);
        --sidebar-primary: oklch(0.21 0.006 285.885);
        --sidebar-primary-foreground: oklch(0.985 0 0);
        --sidebar-accent: oklch(0.967 0.001 286.375);
        --sidebar-accent-foreground: oklch(0.21 0.006 285.885);
        --sidebar-border: oklch(0.92 0.004 286.32);
        --sidebar-ring: oklch(0.705 0.015 286.067);
      }

      @layer base {
        * {
          @apply border-border font-karla;
        }
        body {
          @apply bg-background text-foreground;
        }
      }
    </style>
  </head>
  <body>
    <div class="max-w-4xl mx-auto p-6">
      <div class="mb-6">
        <!-- Back Button -->
        <a href="../stylist-selection/index.html">
          <button
            class="default-button border hover:bg-accent hover:text-dark-fg mb-8"
          >
            Back to Stylists
          </button>
        </a>

        <div class="flex items-center space-x-4 mb-6">
          <div
            class="w-16 h-16 bg-primary rounded-full flex items-center justify-center text-white font-bold text-xl"
          >
            JD
          </div>

          <div>
            <h2 class="text-2xl font-bold text-secondary-foreground">Juan Dela Cruz</h2>
            <p class="text-muted-foreground">Specialty</p>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid:cols-2 gap-8">
        <!-- Select Date Card -->
        <div class="card bg-card">
          <div class="card-header">
            <div class="card-title flex items-center text-dark-fg">
              Select Date
            </div>
          </div>
          <div class="card-content">
            <div id="calendar-root" class="bg-primary/10 border rounded-md border-primary p-3 text-dark-fg"></div>
            <div id="selected-date" class="mt-2 text-sm text-dark-fg"></div>
          </div>
        </div>

        <!-- Available Time Slots Card -->
        <div class="card bg-card">
          <div class="card-header">
            <div class="card-title text-dark-fg">
              <span>Available Time Slots</span>
              <div id="selected-date-header" class="text-sm text-dark-fg"></div>
            </div>
          </div>
          <div class="card-content">
            <div id="time-slots-root" class="w-full text-dark-fg">
              <p id="time-slots-placeholder" class="text-center text-dark-muted-fg py-8">
                Please select a date first
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import { createCalendar } from '../../components/calendar.js';

      const root = document.getElementById('calendar-root');
      const selectedLabel = document.getElementById('selected-date');
      const selectedHeader = document.getElementById('selected-date-header');
      const slotsRoot = document.getElementById('time-slots-root');
      const slotsPlaceholder = document.getElementById('time-slots-placeholder');

      let selectedDate = null;
      let selectedTime = '';
      let availableSlots = [];

      function formatFullDate(d) {
        return d.toLocaleDateString('en-US', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
      }

      // returns half-hour slots from 09:00 to 21:00 (inclusive)
      function getAvailableSlots(stylistId, dateStr) {
        const times = [];
        for (let h = 9; h <= 20; h++) {
          times.push(`${String(h).padStart(2, '0')}:00`);
          times.push(`${String(h).padStart(2, '0')}:30`);
        }
        times.push('21:00'); // end of day slot

        // deterministic availability based on date + stylist id
        const seed = (dateStr || '') + (stylistId || '');
        let s = 0;
        for (const ch of seed) s = (s * 31 + ch.charCodeAt(0)) >>> 0;

        return times.map((t, i) => ({
          time: t,
          available: ((s + i) % 4) !== 0 // 75% available
        }));
      }

      function renderTimeSlots() {
        if (!selectedDate) {
          slotsRoot.innerHTML = '';
          slotsRoot.appendChild(slotsPlaceholder);
          return;
        }

        const grid = document.createElement('div');
        grid.className = 'grid grid-cols-3 gap-2 max-h-80 overflow-y-auto';

        availableSlots.forEach(slot => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.dataset.time = slot.time;
          btn.className = [
            'default-button text-sm w-full justify-center rounded-md',
            slot.available ? '' : 'opacity-50 pointer-events-none',
            selectedTime === slot.time ? 'bg-primary text-primary-foreground' : 'border'
          ].join(' ');
          btn.textContent = slot.time;
          grid.appendChild(btn);
        });

        slotsRoot.innerHTML = '';
        slotsRoot.appendChild(grid);
      }

      // event delegation for slot click
      slotsRoot.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-time]');
        if (!btn) return;
        const time = btn.dataset.time;
        selectedTime = time;
        renderTimeSlots();
        console.log('selected time', time, 'for', selectedDate?.toISOString().split('T')[0]);
      });

      const cal = createCalendar(root, {
        selected: null,
        onSelect(date) {
          selectedDate = date;
          selectedLabel.textContent = date.toDateString();
          selectedHeader.textContent = formatFullDate(date);
          const dateStr = date.toISOString().split('T')[0];
          
          // populate availableSlots and reset selectedTime
          availableSlots = getAvailableSlots('1', dateStr); // replace '1' with actual stylist id if available
          selectedTime = '';
          renderTimeSlots();
          console.log('selected date', dateStr);
        },
        disabled(date) {
          // disable dates before today
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          return date < today;
        }
      });
    </script>
  </body>
</html>
